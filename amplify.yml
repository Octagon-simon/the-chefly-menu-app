version: 1
frontend:
  phases:
    preBuild:
      commands:
        - "nvm use 20"
        - "node -v"
        - "npm install --frozen-lockfile"
        - echo "Creating .env.production and injecting server-only envs"
        # Only server envs
        - env | grep -E '^(PAYSTACK_SECRET_KEY|FIREBASE_CLIENT_EMAIL|RESEND_API_KEY|FIREBASE_PRIVATE_KEY|FIREBASE_DATABASE_URL|FIREBASE_PROJECT_ID|APP_URL)=' > .env.production || true
    build:
      commands:
        - "npm run build"
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - ".next/cache/**/*"
      - "node_modules/**/*"
